var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(j){j.name="mustache.js";j.version="0.5.1-dev";j.tags=["{{","}}"];j.parse=parse;j.clearCache=clearCache;j.compile=compile;j.compilePartial=compilePartial;j.render=render;j.Scanner=Scanner;j.Context=Context;j.Renderer=Renderer;j.to_html=function(a,b,c,d){var e=render(a,b,c);if(typeof d==="function"){d(e)}else{return e}};var k=/\s*/;var l=/\s+/;var m=/\S/;var n=/\s*=/;var o=/\s*\}/;var p=/#|\^|\/|>|\{|&|=|!/;function testRe(a,b){return RegExp.prototype.test.call(a,b)}function isWhitespace(a){return!testRe(m,a)}var q=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"};var r=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm;function quote(a){var b=a.replace(r,function(c){return"\\u"+('0000'+c.charCodeAt(0).toString(16)).slice(-4)});return'"'+b+'"'}function escapeRe(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function escapeHtml(a){return String(a).replace(/[&<>"'\/]/g,function(s){return t[s]})}j.isWhitespace=isWhitespace;j.isArray=q;j.quote=quote;j.escapeRe=escapeRe;j.escapeHtml=escapeHtml;function Scanner(a){this.string=a;this.tail=a;this.pos=0}Scanner.prototype.eos=function(){return this.tail===""};Scanner.prototype.scan=function(a){var b=this.tail.match(a);if(b&&b.index===0){this.tail=this.tail.substring(b[0].length);this.pos+=b[0].length;return b[0]}return null};Scanner.prototype.scanUntil=function(a){var b,pos=this.tail.search(a);switch(pos){case-1:b=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:b=null;break;default:b=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos}return b};function Context(a,b){this.view=a;this.parent=b;this.clearCache()}Context.make=function(a){return(a instanceof Context)?a:new Context(a)};Context.prototype.clearCache=function(){this._cache={}};Context.prototype.push=function(a){return new Context(a,this)};Context.prototype.lookup=function(a){var b=this._cache[a];if(!b){if(a==="."){b=this.view}else{var c=this;while(c){if(a.indexOf(".")>0){var d=a.split("."),i=0;b=c.view;while(b&&i<d.length){b=b[d[i++]]}}else{b=c.view[a]}if(b!=null){break}c=c.parent}}this._cache[a]=b}if(typeof b==="function"){b=b.call(this.view)}return b};function Renderer(){this.clearCache()}Renderer.prototype.clearCache=function(){this._cache={};this._partialCache={}};Renderer.prototype.compile=function(b,c){var d=compileTokens(b),self=this;return function(a){return d(Context.make(a),self)}};Renderer.prototype.compilePartial=function(a,b,c){this._partialCache[a]=this.compile(b,c);return this._partialCache[a]};Renderer.prototype.render=function(a,b){var c=this._cache[a];if(!c){c=this.compile(a);this._cache[a]=c}return c(b)};Renderer.prototype._section=function(b,c,d){var e=c.lookup(b);switch(typeof e){case"object":if(q(e)){var f="";for(var i=0,len=e.length;i<len;++i){f+=d(c.push(e[i]),this)}return f}else{return d(c.push(e),this)}break;case"function":var g=d(c,this),self=this;var h=function(a){return self.render(a,c)};return e.call(c.view,g,h)||"";break;default:if(e){return d(c,this)}}return""};Renderer.prototype._inverted=function(a,b,c){var d=b.lookup(a);if(d==null||d===false||(q(d)&&d.length===0)){return c(b,this)}return""};Renderer.prototype._partial=function(a,b){var c=this._partialCache[a];if(c){return c(b,this)}return""};Renderer.prototype._name=function(a,b,c){var d=b.lookup(a);if(typeof d==="function"){d=d.call(b.view)}var e=(d==null)?"":String(d);if(c){return escapeHtml(e)}return e};function compileTokens(a,b){if(typeof a==="string"){a=parse(a)}var c=['""'];var d,method,escape;for(var i=0,len=a.length;i<len;++i){d=a[i];switch(d.type){case"#":case"^":method=(d.type==="#")?"_section":"_inverted";c.push("r."+method+"("+quote(d.value)+", c, function (c, r) {\n"+"  "+compileTokens(d.tokens,true)+"\n"+"})");break;case"{":case"&":case"name":escape=d.type==="name"?"true":"false";c.push("r._name("+quote(d.value)+", c, "+escape+")");break;case">":c.push("r._partial("+quote(d.value)+", c)");break;case"text":c.push(quote(d.value));break}}c="return "+c.join(" + ")+";";if(b){return c}return new Function("c, r",c)}function escapeTags(a){if(a.length===2){return[new RegExp(escapeRe(a[0])+"\\s*"),new RegExp("\\s*"+escapeRe(a[1]))]}throw new Error("Invalid tags: "+a.join(" "));}function nestTokens(a){var b=[];var c=b;var d=[];var e,section;for(var i=0;i<a.length;++i){e=a[i];switch(e.type){case"#":case"^":e.tokens=[];d.push(e);c.push(e);c=e.tokens;break;case"/":if(d.length===0){throw new Error("Unopened section: "+e.value);}section=d.pop();if(section.value!==e.value){throw new Error("Unclosed section: "+section.value);}if(d.length>0){c=d[d.length-1].tokens}else{c=b}break;default:c.push(e)}}section=d.pop();if(section){throw new Error("Unclosed section: "+section.value);}return b}function squashTokens(a){var b;for(var i=0;i<a.length;++i){var c=a[i];if(b&&b.type==="text"&&c.type==="text"){b.value+=c.value;a.splice(i--,1)}else{b=c}}}function parse(a,b){b=b||j.tags;var c=escapeTags(b);var d=new Scanner(a);var e=[],spaces=[],hasTag=false,nonSpace=false;var f=function(){if(hasTag&&!nonSpace){while(spaces.length){e.splice(spaces.pop(),1)}}else{spaces=[]}hasTag=false;nonSpace=false};var g,value,chr;while(!d.eos()){value=d.scanUntil(c[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value[i];if(isWhitespace(chr)){spaces.push(e.length)}else{nonSpace=true}e.push({type:"text",value:chr});if(chr==="\n"){f()}}}if(!d.scan(c[0])){break}hasTag=true;g=d.scan(p)||"name";d.scan(k);if(g==="="){value=d.scanUntil(n);d.scan(n);d.scanUntil(c[1])}else if(g==="{"){var h=new RegExp("\\s*"+escapeRe("}"+b[1]));value=d.scanUntil(h);d.scan(o);d.scanUntil(c[1])}else{value=d.scanUntil(c[1])}if(!d.scan(c[1])){throw new Error("Unclosed tag at "+d.pos);}e.push({type:g,value:value});if(g==="name"||g==="{"||g==="&"){nonSpace=true}if(g==="="){b=value.split(l);c=escapeTags(b)}}squashTokens(e);return nestTokens(e)}var u=new Renderer;function clearCache(){u.clearCache()}function compile(a,b){return u.compile(a,b)}function compilePartial(a,b,c){return u.compilePartial(a,b,c)}function render(a,b,c){if(c){for(var d in c){compilePartial(d,c[d])}}return u.render(a,b)}})(Mustache);
